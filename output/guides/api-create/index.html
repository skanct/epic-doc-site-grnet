<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>API | Create a PID</title>
  <link rel="alternate" type="application/atom+xml" title="API Changes" href="/changes.atom" />
  <link href="/css/reset.css" rel="stylesheet" type="text/css" />
  <link href="/css/960.css" rel="stylesheet" type="text/css" />
  <link href="/css/uv_active4d.css" rel="stylesheet" type="text/css" />
  <link href="/shared/css/documentation.css" media="screen" rel="stylesheet" type="text/css">
  <link href="/shared/css/pygments.css" media="screen" rel="stylesheet" type="text/css">
  <script src="/shared/js/jquery.js" type="text/javascript"></script>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans+Condensed:700,300,300italic' rel='stylesheet' type='text/css'>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

<script>
  $(function () {
    $('#myTab a:last').tab('show')
  })
</script>


<body class="api">
  <nav role="navigation" class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <button data-target=".bs-navbar-collapse" data-toggle="collapse" type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">Epic Api</a>
    </div>
    <nav role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/guides/overview" class="nav-overview"><span class="glyphicon glyphicon-list-alt"></span> Overview</a></li>
        <li><a href="/guides/api/" class="nav-api"><span class="glyphicon glyphicon-wrench"></span> API</a></li>
        <li><a href="/guides/glossary/" class="nav-blog"><span class="glyphicon glyphicon-sort-by-alphabet"></span> Glossary</a></li>
      </ul>
    </nav>
  </div>
</nav>
<!--<div id="header-wrapper">
-->
<!--  <div id="header">
    <div>
      <a class="logo" href="/">GRNET PID Service</a>
      <ul class="nav">
        <li><a href="/guides/overview" class="nav-overview">Overview</a></li>
        <li><a href="/guides/api/" class="nav-api">API</a></li>
        <li><a href="/guides/glossary/" class="nav-blog">Glossary</a></li>
      </ul>
    </div>
    </div>
    </div>
-->


  <div id="wrapper">
    <div class="content">
      <h1 id="api---create-a-new-pid">API - Create a new PID</h1>

<p>This API uses JSON as the primary exchange format. All implementations MUST be able to produce and consume JSON.</p>

<h2 id="create-a-new-pid---description">Create a new PID - Description</h2>

<p>You want to create a new PID. There are two ways to create - generate a new PID </p>

<ul>
  <li>automatic generation of the suffix name via the POST method</li>
  <li>manual generation of the suffix name via the PUT method</li>
</ul>

<p>HTTP PUT can be used for both resource creation and resource updates .
So if you want to be sure that you are going to create a new one you must first check if it exists. If you don’t check the existence of a PID based on the suffix it is possible that you will update the data of an existing one. </p>

<p>There is a way to make your HTTP PUT request “conditional” in the sense that it will only be executed if the URL doesn’t exist yet (which constitutes a create action), or that it does exist yet (which constitutes an update ). </p>

<p class="text-warning"><span class="label label-success">Info</span> In order to make the PUT request conditional use HTTP’s If-Match: * or If-None-Match:* headers.</p>

<table>
  <tbody>
    <tr>
      <td><strong>Description</strong></td>
      <td>Create a new PID</td>
    </tr>
    <tr>
      <td><strong>URL</strong></td>
      <td>The GRNET API Service URL</td>
    </tr>
    <tr>
      <td><strong>HTTP Method</strong></td>
      <td>PUT for manual generation of suffix name</td>
    </tr>
    <tr>
      <td><strong>HTTP Method</strong></td>
      <td>POST for automatic generation of suffix name</td>
    </tr>
    <tr>
      <td><strong>Security</strong></td>
      <td>Requires ownership of the PID. So you must authenticate before actually creating the PID</td>
    </tr>
  </tbody>
</table>

<p>The data you must send in order to create are described in the following table </p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default value</th>
      <th>Example value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>suffix</td>
      <td>The local name of the handle in the system</td>
      <td>Yes</td>
      <td>None</td>
      <td>a) use a UUID generator via <strong>PUT method</strong>, b) automatic generation via <strong>POST method</strong>
</td>
    </tr>
  </tbody>
</table>

<p>The data you must send as json representation are described in the following table </p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default value</th>
      <th>Example value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>type</td>
      <td>Each handle has a set of values assigned to it.  These handle values use a common data structure for its data. The data type defines the syntax and semantics of the data in its data field.</td>
      <td>Yes</td>
      <td>None</td>
      <td>URL</td>
    </tr>
    <tr>
      <td>parsed_data</td>
      <td>A set of data that describes the resource identified by the handle. The syntax and semantics of parsed data are identified by the <type> field.</type>
</td>
      <td>Yes</td>
      <td>None</td>
      <td>http://www.grnet.gr</td>
    </tr>
    <tr>
      <td>timestamp</td>
      <td>The timestamp records the last time this Handle Value was updated at the server. The field contains elapsed time since 00:00:00 UTC, January 1970 in milliseconds.</td>
      <td>NO</td>
      <td>timestamp</td>
      <td>2013-11-26T11:58:14Z</td>
    </tr>
    <tr>
      <td>ttl_type</td>
      <td>the TTL type indicates whether the TTL value is absolute or relative.  The absolute TTL value defines the time to live in terms of seconds since 00:00:00 UTC, January 1st 1970.  A relative TTL specifies the time to live in terms of the number of seconds elapsed since the value was obtained by the client from any handle server.</td>
      <td>NO</td>
      <td>integer 0=relative, 1=absolute by default 0</td>
      <td>0</td>
    </tr>
    <tr>
      <td>ttl</td>
      <td>a number that specifies the Time-To- Live of the value record. A positive value defines the time to live in terms of seconds since 00:00:00 UTC, January 1st 1970. A negative value specifies the time to live in terms of the number of seconds elapsed since the value was obtained. (if ttl_type is absolute, then this indicates the date/time of expiration in seconds since Jan 1 0:00:00 1970.)</td>
      <td>NO</td>
      <td>integer seconds</td>
      <td>86400</td>
    </tr>
    <tr>
      <td>refs</td>
      <td>a list of references to other Handle Values</td>
      <td>No</td>
      <td>None</td>
      <td>[{‘idx’:’1’,’handle’:’11239/12’}] where idx is the value for index field of handle data, and handle is the referenced handle value</td>
    </tr>
  </tbody>
</table>

<h2 id="example">Example</h2>

<p>In this example we are going to create a new handle via the PUT method  in the following url https://epic.grnet.gr/handles/11239/UUIDGENERATE. There is an example via POST method at <a href="/guides/api-generation/">PID generation page</a></p>




<ul class="nav nav-tabs">
	
	  
		  <li class="active"><a href="#tab-1" data-toggle="tab">Curl</a></li>
	  
	
	  
		  <li><a href="#tab-2" data-toggle="tab">Python</a></li>
	
	
	  
		  <li><a href="#tab-3" data-toggle="tab">PHP</a></li>
	
	
	  
		  <li><a href="#tab-4" data-toggle="tab">Perl</a></li>
	
	
</ul>
<div class="tab-content">
	
	 
	 <div class="tab-pane active" id="tab-1">
	  
		<p>The request in curl</p>

<pre><code>
#!/bin/bash    

SUFFIX=`uuidgen`
curl -v -u "YOURUSERNAME:YOURPASSWORD" -H "Accept:application/json" -H "Content-Type:application/json" -X PUT --data '[{"type":"URL","parsed_data":"http://www.grnet.gr/"}]' https://epic.grnet.gr/api/v2/handles/11239/$SUFFIX 

</code></pre>

	 </div>
	
	 
	 <div class="tab-pane" id="tab-2">
	
		<p>The request in python</p>

<pre><code class="language-python"><span class="kn">import</span> <span class="nn">urllib2</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">PIDSERVICE_URL</span><span class="o">=</span><span class="s">"THE_SERVICE_URL_WITH_PREFIX"</span>
<span class="n">PIDSERVICE_USER</span><span class="o">=</span><span class="s">"YOURUSERNAME"</span>
<span class="n">PIDSERVICE_PASSWD</span><span class="o">=</span><span class="s">"YOURPASSWORD"</span>
<span class="n">SUFFIX</span> <span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">());</span>
<span class="n">URL_TO_OPEN</span><span class="o">=</span><span class="n">PIDSERVICE_URL</span><span class="o">+</span><span class="n">SUFFIX</span>
<span class="n">DATAURL</span><span class="o">=</span><span class="s">''</span>

<span class="c"># create a password manager</span>
<span class="n">password_mgr</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPPasswordMgrWithDefaultRealm</span><span class="p">()</span>

<span class="c"># Add the username and password.</span>
<span class="n">password_mgr</span><span class="o">.</span><span class="n">add_password</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">PIDSERVICE_URL</span><span class="p">,</span> <span class="n">PIDSERVICE_USER</span><span class="p">,</span> <span class="n">PIDSERVICE_PASSWD</span><span class="p">)</span>

<span class="n">handler</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPBasicAuthHandler</span><span class="p">(</span><span class="n">password_mgr</span><span class="p">)</span>

<span class="c"># create "opener" (OpenerDirector instance)</span>
<span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="c"># use the opener to fetch a URL</span>
<span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">PIDSERVICE_URL</span><span class="p">)</span>

<span class="c"># Install the opener.</span>
<span class="c"># Now all calls to urllib2.urlopen use the created opener.</span>
<span class="n">urllib2</span><span class="o">.</span><span class="n">install_opener</span><span class="p">(</span><span class="n">opener</span><span class="p">)</span>

<span class="c">#create the json data</span>
<span class="n">JSONDATA</span> <span class="o">=</span> <span class="p">[{</span><span class="s">'type'</span><span class="p">:</span><span class="s">'URL'</span><span class="p">,</span><span class="s">'parsed_data'</span><span class="p">:</span><span class="s">'http://www.grnet.gr'</span><span class="p">}]</span>
<span class="n">JSONDATATOSEND</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">JSONDATA</span><span class="p">);</span>

<span class="n">REQUESTDATA</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">URL_TO_OPEN</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">JSONDATATOSEND</span><span class="p">)</span>

<span class="c">#create the headers</span>
<span class="n">REQUESTDATA</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">'Content-Type'</span><span class="p">,</span><span class="s">'application/json'</span><span class="p">)</span>
<span class="n">REQUESTDATA</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">'Content-Length'</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">JSONDATATOSEND</span><span class="p">))</span>

<span class="c"># creates the PUT method</span>
<span class="n">REQUESTDATA</span><span class="o">.</span><span class="n">get_method</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s">'PUT'</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">DATAURL</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">REQUESTDATA</span><span class="p">)</span>
    
<span class="k">except</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">URLError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">e</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">"404-Not found"</span>
    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">"401-Authentication failed"</span>    
        <span class="c">#get http code of the request</span>

<span class="k">if</span> <span class="n">DATAURL</span><span class="p">:</span>
    <span class="c"># Getting the code</span>
    <span class="k">print</span> <span class="s">"This gets the code: "</span><span class="p">,</span> <span class="n">DATAURL</span><span class="o">.</span><span class="n">code</span></code></pre>

	 </div>
	
	 
	 <div class="tab-pane" id="tab-3">
	
		<p>The request in php </p>

<pre><code class="language-php5"><span class="nv">$PIDSERVICE_URL</span><span class="o">=</span><span class="s2">"THE_SERVICE_URL_WITH_PREFIX"</span><span class="p">;</span>
<span class="nv">$PIDSERVICE_USER</span><span class="o">=</span><span class="s2">"YOURUSERNAME"</span><span class="p">;</span>
<span class="nv">$PIDSERVICE_PASSWD</span><span class="o">=</span><span class="s2">"YOURPASSWORD"</span><span class="p">;</span>
<span class="nv">$UUID</span> <span class="o">=</span> <span class="nx">gen_uuid</span><span class="p">();</span> <span class="c1">//a function to generate a uuid</span>
<span class="nv">$URL_TO_OPEN</span> <span class="o">=</span> <span class="nv">$PIDSERVICE_URL</span><span class="o">.</span><span class="nv">$UUID</span><span class="p">;</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'URL'</span><span class="p">,</span><span class="s1">'parsed_data'</span><span class="o">=&gt;</span><span class="s1">'http://www.grnet.gr/'</span><span class="p">));</span>
<span class="nv">$update_json</span><span class="o">=</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>

<span class="c1">// Get cURL resource</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>

<span class="c1">//Set the headers to complete the request</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">,</span><span class="s1">'Content-Length: '</span> <span class="o">.</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$update_json</span><span class="p">)));</span>

<span class="c1">//set the PUT Action</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="s2">"PUT"</span><span class="p">);</span>

<span class="c1">//SET the postfield data</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span><span class="nv">$update_json</span><span class="p">);</span>

<span class="c1">// Should cURL return or print out the data? (true = return, false = print)</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">//Set the url with the new name of the PID </span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$URL_TO_OPEN</span><span class="p">);</span>

<span class="c1">// Set the authentication options</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_USERPWD</span><span class="p">,</span> <span class="nv">$PIDSERVICE_USER</span><span class="o">.</span><span class="s2">":"</span><span class="o">.</span><span class="nv">$PIDSERVICE_PASSWD</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPAUTH</span><span class="p">,</span> <span class="nx">CURLAUTH_BASIC</span><span class="p">);</span>

<span class="nv">$output</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nv">$info</span> <span class="o">=</span> <span class="nb">curl_getinfo</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>

<span class="c1">// Download the given URL, and return output </span>

<span class="k">if</span><span class="p">(</span> <span class="nv">$info</span><span class="p">[</span><span class="s1">'http_code'</span><span class="p">]</span><span class="o">==</span><span class="mi">200</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">"HANDLE EXISTS"</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="nv">$info</span><span class="p">[</span><span class="s1">'http_code'</span><span class="p">]</span><span class="o">==</span><span class="mi">201</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">"PID CREATED"</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="nv">$info</span><span class="p">[</span><span class="s1">'http_code'</span><span class="p">]</span><span class="o">==</span><span class="mi">204</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">"PID UPDATED"</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="nv">$info</span><span class="p">[</span><span class="s1">'http_code'</span><span class="p">]</span><span class="o">==</span><span class="mi">404</span><span class="p">)</span> <span class="k">echo</span> <span class="s2">"HANDLE DOESNT EXIST"</span><span class="p">;</span>

<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">gen_uuid</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span> <span class="s1">'%04x%04x-%04x-%04x-%04x-%04x%04x%04x'</span><span class="p">,</span>
            <span class="c1">// 32 bits for "time_low"</span>
            <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffff</span> <span class="p">),</span> <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffff</span> <span class="p">),</span>

            <span class="c1">// 16 bits for "time_mid"</span>
            <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffff</span> <span class="p">),</span>

            <span class="c1">// 16 bits for "time_hi_and_version",</span>
            <span class="c1">// four most significant bits holds version number 4</span>
            <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0fff</span> <span class="p">)</span> <span class="o">|</span> <span class="mh">0x4000</span><span class="p">,</span>

            <span class="c1">// 16 bits, 8 bits for "clk_seq_hi_res",</span>
            <span class="c1">// 8 bits for "clk_seq_low",</span>
            <span class="c1">// two most significant bits holds zero and one for variant DCE1.1</span>
            <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x3fff</span> <span class="p">)</span> <span class="o">|</span> <span class="mh">0x8000</span><span class="p">,</span>

            <span class="c1">// 48 bits for "node"</span>
            <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffff</span> <span class="p">),</span> <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffff</span> <span class="p">),</span> <span class="nx">mt_rand</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffff</span> <span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span></code></pre>

	 </div>
	
	 
	 <div class="tab-pane" id="tab-4">
	
		<p>The request in perl</p>

<pre><code class="language-perl"><span class="c1">#!/usr/bin/perl</span>

<span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="n">warnings</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Data::</span><span class="n">Dumper</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Getopt::</span><span class="n">Long</span><span class="p">;</span>
<span class="k">use</span> <span class="n">Switch</span> <span class="s">'Perl5'</span><span class="p">,</span> <span class="s">'Perl6'</span><span class="p">;</span>
<span class="k">use</span> <span class="n">JSON</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">WWW::Curl::</span><span class="n">Easy</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$fullargv0</span> <span class="o">=</span> <span class="nv">$0</span><span class="p">;</span>
<span class="k">my</span> <span class="p">(</span><span class="nv">$argv0</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$fullargv0</span> <span class="o">=~</span><span class="sr"> /([^\/\\]+)$/</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">%settings</span> <span class="o">=</span> <span class="p">(</span>
<span class="s">'debug'</span> <span class="o">=&gt;</span> <span class="s">'False'</span><span class="p">,</span>
<span class="s">'handle'</span> <span class="o">=&gt;</span> <span class="p">{</span>
	<span class="s">'action'</span> <span class="o">=&gt;</span><span class="s">'put'</span><span class="p">,</span>
	<span class="s">'credentials'</span> 	<span class="o">=&gt;</span>	<span class="p">{</span>
		<span class="s">'username'</span>	<span class="o">=&gt;</span> <span class="s">'empty'</span><span class="p">,</span>
		<span class="s">'password'</span>	<span class="o">=&gt;</span> <span class="s">'empty'</span><span class="p">,</span>
		<span class="s">'baseuri'</span>	<span class="o">=&gt;</span> <span class="s">'empty'</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="s">'data'</span>	<span class="o">=&gt;</span><span class="p">{</span>
		<span class="s">'get'</span>	<span class="o">=&gt;</span> <span class="s">''</span><span class="p">,</span>
		<span class="s">'putpost'</span><span class="o">=&gt;</span> <span class="s">''</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="s">'format'</span> <span class="o">=&gt;</span> <span class="s">'none'</span><span class="p">,</span>
	<span class="s">'headerextra'</span>	<span class="o">=&gt;</span> <span class="s">''</span><span class="p">,</span>
	<span class="s">'type'</span> <span class="o">=&gt;</span> <span class="s">'none'</span><span class="p">,</span>
	<span class="s">'url'</span><span class="o">=&gt;</span>	<span class="p">{</span>
		<span class="s">'pid'</span><span class="o">=&gt;</span> <span class="s">'ADD A PID'</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">},</span>
<span class="p">);</span>

<span class="c1"># Main subroutine</span>
<span class="k">sub </span><span class="nf">main</span> <span class="p">{</span>

	<span class="c1">#Get the subroutine arguments</span>
	<span class="k">my</span> <span class="nv">$settings_ref</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

	<span class="c1"># Get the script arguments</span>
	<span class="p">(</span><span class="k">my</span> <span class="nv">$returncode</span><span class="p">)</span> <span class="o">=</span> <span class="n">get_arguments</span><span class="p">(</span><span class="nv">$settings_ref</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="nv">$returncode</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> 
		 <span class="n">performPut</span><span class="p">(</span><span class="nv">$settings_ref</span><span class="p">);</span>

	<span class="k">return</span><span class="p">(</span><span class="nv">$returncode</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="c1"># Subroutine to perform a PUT action</span>
<span class="k">sub </span><span class="nf">performPut</span> <span class="p">{</span>

	<span class="c1"># Get the subroutine arguments</span>
	<span class="k">my</span> <span class="nv">$settings_ref</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

	<span class="c1">#construct url and headers</span>
	<span class="k">my</span> <span class="nv">$url</span><span class="o">=</span><span class="s">"$settings_ref-&gt;{handle}-&gt;{credentials}-&gt;{baseuri}$settings_ref-&gt;{handle}-&gt;{url}-&gt;{pid}"</span><span class="p">;</span>
	<span class="nb">printf</span><span class="p">(</span><span class="s">"The constructed url is        : %s\n"</span><span class="p">,</span><span class="nv">$url</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
	<span class="k">my</span> <span class="nv">@httpHeaders</span> <span class="o">=</span> <span class="p">(</span> <span class="s">'Content-Type: application/json'</span> <span class="p">);</span>
	<span class="c1"># add extra header info. f.i. "If-Match: *" or "If-None-Match: *"</span>
	<span class="nb">push</span><span class="p">(</span><span class="nv">@httpHeaders</span><span class="p">,</span> <span class="s">"$settings_ref-&gt;{handle}-&gt;{headerextra}"</span> <span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">headerextra</span><span class="p">}</span> <span class="p">;</span>

	<span class="c1">#construct data</span>
	<span class="k">my</span> <span class="nv">$data</span><span class="o">=</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">data</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">putpost</span><span class="p">};</span>
	<span class="nb">printf</span><span class="p">(</span><span class="s">"The data is                   : %s\n"</span><span class="p">,</span><span class="nv">$data</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="c1"># perform action</span>
	<span class="p">(</span><span class="k">my</span> <span class="nv">$returncode</span><span class="p">,</span> <span class="k">my</span> <span class="nv">$response_code</span><span class="p">,</span> <span class="k">my</span> <span class="nv">$response_content_type</span><span class="p">,</span> <span class="k">my</span> <span class="nv">$response_body</span> <span class="p">)</span> <span class="o">=</span> <span class="n">httpPut</span><span class="p">(</span><span class="nv">$settings_ref</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="o">\</span><span class="nv">@httpHeaders</span><span class="p">,</span> <span class="nv">$data</span> <span class="p">);</span>

	<span class="c1"># Looking at the results of the curl request</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span><span class="p">(</span><span class="s">'Transfer went ok\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

		<span class="c1"># judge result and next action based on $response_code</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$response_code</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nv">$response_code</span> <span class="o">&lt;</span> <span class="mi">300</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">print</span><span class="p">(</span><span class="s">'The request went ok\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">print</span><span class="p">(</span><span class="s">'The request went NOT ok\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"$response_code\n"</span><span class="p">);</span>
		<span class="p">}</span> 

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">print</span><span class="p">(</span><span class="s">'An error happened\n'</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1"># reader helper calback function</span>
<span class="k">sub </span><span class="nf">read_callback</span> <span class="p">{</span>
	<span class="k">my</span> <span class="p">(</span><span class="nv">$maxlength</span><span class="p">,</span><span class="nv">$pointer</span><span class="p">)</span><span class="o">=</span><span class="nv">@_</span><span class="p">;</span>
	<span class="c1"># printf("The MAXLENGTH is     : \n", $maxlength);</span>
	<span class="c1"># printf("The POINTER is       : \n", $$pointer) ;</span>
	<span class="k">my</span> <span class="nv">$data</span> <span class="o">=</span> <span class="nv">$$pointer</span><span class="p">;</span>
	<span class="nv">$$pointer</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
	<span class="k">return</span> <span class="nv">$data</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Subroutine to post data via a http PUT</span>
<span class="k">sub </span><span class="nf">httpPut</span> <span class="p">{</span>

	<span class="c1"># Get the subroutine arguments</span>
	<span class="k">my</span> <span class="nv">$settings_ref</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$url</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$httpHeaders_ref</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$data</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

	<span class="k">print</span><span class="p">(</span><span class="s">'Entering httpPut              :\n'</span><span class="p">)</span>         <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span><span class="p">;</span>

	<span class="c1"># local varables</span>
	<span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="nb">length</span> <span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
	<span class="k">my</span> <span class="nv">$body</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$header</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$response_body</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$response_code</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$response_content_type</span><span class="p">;</span>

	<span class="k">my</span> <span class="nv">$curl</span> <span class="o">=</span> <span class="nn">WWW::Curl::</span><span class="n">Easy</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">;</span>

	<span class="c1"># set options for the curl http request</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_HEADER</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="nv">$httpHeaders_ref</span> <span class="p">);</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_READFUNCTION</span><span class="p">,</span> <span class="o">\&amp;</span><span class="n">read_callback</span><span class="p">);</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_UPLOAD</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_INFILE</span><span class="p">,</span> <span class="o">\</span><span class="nv">$data</span><span class="p">);</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_INFILESIZE</span><span class="p">,</span> <span class="nb">length</span><span class="p">(</span><span class="nv">$data</span><span class="p">));</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_USERNAME</span><span class="p">,</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">username</span><span class="p">});</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_PASSWORD</span><span class="p">,</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">password</span><span class="p">});</span>

	<span class="c1">#debugging</span>
	<span class="c1">#$curl-&gt;setopt (CURLOPT_VERBOSE, 1);</span>

	<span class="c1"># A filehandle, reference to a scalar or reference to a typeglob can be used here.</span>
	<span class="nb">open</span> <span class="k">my</span> <span class="nv">$fh</span><span class="p">,</span> <span class="s">'&gt;'</span><span class="p">,</span> <span class="o">\</span><span class="nv">$response_body</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">"$!"</span><span class="p">;</span>
	<span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">setopt</span><span class="p">(</span><span class="n">CURLOPT_WRITEDATA</span><span class="p">,</span> <span class="nv">$fh</span><span class="p">);</span>

	<span class="c1"># Do the actual curl http request</span>
	<span class="k">my</span> <span class="nv">$returncode</span> <span class="o">=</span> <span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">perform</span><span class="p">;</span>

	<span class="c1"># close file handle</span>
	<span class="nb">close</span><span class="p">(</span><span class="nv">$fh</span><span class="p">);</span>

	<span class="c1"># Looking at the results of the curl request</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">print</span><span class="p">(</span><span class="s">'Transfer went ok\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

		<span class="nv">$response_code</span>         <span class="o">=</span> <span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">getinfo</span><span class="p">(</span><span class="n">CURLINFO_HTTP_CODE</span><span class="p">);</span>
		<span class="nv">$response_content_type</span> <span class="o">=</span> <span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">getinfo</span><span class="p">(</span><span class="n">CURLINFO_CONTENT_TYPE</span><span class="p">);</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Received response code        : $response_code\n"</span><span class="p">)</span>         <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span><span class="p">;</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"Received response content type: $response_content_type\n"</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span><span class="p">;</span>

		<span class="c1"># judge result and next action based on $response_code</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$response_code</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nv">$response_code</span> <span class="o">&lt;</span> <span class="mi">300</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">print</span><span class="p">(</span><span class="s">'The request went ok\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"$response_body\n"</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">print</span><span class="p">(</span><span class="s">'The request went NOT ok\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
			<span class="k">print</span><span class="p">(</span><span class="s">"$response_code\n"</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span><span class="p">;</span>
		<span class="p">}</span> 

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1"># Error code, type of error, error message</span>
		<span class="k">print</span><span class="p">(</span><span class="s">"An error happened: $returncode "</span><span class="o">.</span><span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">strerror</span><span class="p">(</span><span class="nv">$returncode</span><span class="p">)</span><span class="o">.</span><span class="s">" "</span><span class="o">.</span><span class="nv">$curl</span><span class="o">-&gt;</span><span class="n">errbuf</span><span class="o">.</span><span class="s">"\n"</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="c1"># Return the results</span>
	<span class="k">return</span><span class="p">(</span><span class="nv">$returncode</span><span class="p">,</span> <span class="nv">$response_code</span><span class="p">,</span> <span class="nv">$response_content_type</span><span class="p">,</span> <span class="nv">$response_body</span> <span class="p">);</span>
<span class="p">}</span>
<span class="c1"># Subroutine to get and check all script arguments</span>
<span class="k">sub </span><span class="nf">get_arguments</span> <span class="p">{</span>

	<span class="c1"># Get the subroutine arguments</span>
	<span class="k">my</span> <span class="nv">$settings_ref</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

	<span class="c1"># Define local variables</span>
	<span class="k">my</span> <span class="nv">%arguments</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$username</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$password</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$baseUri</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$pidUrl</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$credentials</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$handleData</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$type</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$header</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$returncode</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">$message</span><span class="p">;</span>
	<span class="k">my</span> <span class="nv">@sources</span><span class="p">;</span>

	<span class="n">GetOptions</span><span class="p">(</span> <span class="s">'h|help'</span>    <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$arguments</span><span class="p">{</span><span class="n">help</span><span class="p">},</span>
		<span class="s">'user=s'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$username</span><span class="p">,</span>
		<span class="s">'passwd=s'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$password</span><span class="p">,</span>
		<span class="s">'base=s'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$baseUri</span><span class="p">,</span>
		<span class="s">'pid=s'</span>			<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$pidUrl</span><span class="p">,</span>
		<span class="s">'cred=s'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$credentials</span><span class="p">,</span>
		<span class="s">'data=s'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$handleData</span><span class="p">,</span>
		<span class="s">'type=s'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$type</span><span class="p">,</span>
		<span class="s">'header=s'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$header</span><span class="p">,</span>
		<span class="s">'get'</span>			<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$arguments</span><span class="p">{</span><span class="n">get</span><span class="p">},</span>
		<span class="s">'put'</span>			<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$arguments</span><span class="p">{</span><span class="n">put</span><span class="p">},</span>
		<span class="s">'delete'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$arguments</span><span class="p">{</span><span class="nb">delete</span><span class="p">},</span>
		<span class="s">'post'</span>			<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$arguments</span><span class="p">{</span><span class="n">post</span><span class="p">},</span>
		<span class="s">'pretty'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$arguments</span><span class="p">{</span><span class="n">pretty</span><span class="p">},</span>
		<span class="s">'d|debug'</span>		<span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$arguments</span><span class="p">{</span><span class="n">debug</span><span class="p">},</span>
	<span class="p">);</span>

	<span class="c1"># Check the help flag</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$arguments</span><span class="p">{</span><span class="n">help</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

		<span class="c1"># Set the returncode</span>
		<span class="nv">$returncode</span><span class="o">=</span><span class="mi">255</span><span class="p">;</span>

		<span class="nv">$message</span> <span class="o">=</span> <span class="n">print_help</span><span class="p">();</span>
	<span class="p">}</span>
	
	<span class="c1"># Check the debug flag</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$arguments</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=</span> <span class="s">'True'</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">'debug is                      : on\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span>

	<span class="c1"># Check the pretty flag</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$arguments</span><span class="p">{</span><span class="n">pretty</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nb">format</span><span class="p">}</span> <span class="o">=</span> <span class="s">'pretty'</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">'pretty format printing is     : on\n'</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span>

	<span class="c1"># Check the action flag's (get,put,delete,post,search,nagios)</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$arguments</span><span class="p">{</span><span class="n">get</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">}</span> <span class="o">=</span> <span class="s">'get'</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The action is                 : %s\n"</span><span class="p">,</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$arguments</span><span class="p">{</span><span class="n">put</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">}</span> <span class="o">=</span> <span class="s">'put'</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The action is                 : %s\n"</span><span class="p">,</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$arguments</span><span class="p">{</span><span class="nb">delete</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">}</span> <span class="o">=</span> <span class="s">'delete'</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The action is                 : %s\n"</span><span class="p">,</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span> <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$arguments</span><span class="p">{</span><span class="n">post</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">}</span> <span class="o">=</span> <span class="s">'post'</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The action is                 : %s\n"</span><span class="p">,</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">action</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span>

	<span class="c1"># check the username</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$username</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">username</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$username</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The username is               : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">username</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span>

	<span class="c1"># check the password</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$password</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">password</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$password</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The password is               : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">password</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span>

	<span class="c1"># check the base uri</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$baseUri</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">baseuri</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$baseUri</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The base uri is               : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">baseuri</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span>

	<span class="c1"># check the pid url</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$pidUrl</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">url</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">pid</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$pidUrl</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The pid is                    : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">url</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">pid</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
	
	<span class="p">}</span>

	<span class="c1"># check the handle data</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$handleData</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">data</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">putpost</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$handleData</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The data is                   : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">data</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">putpost</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
	
	<span class="p">}</span>

	<span class="c1"># check the type data</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$type</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">type</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$type</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The type(s) to show is/are    : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">type</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>

	<span class="p">}</span>
	
	<span class="c1"># check the header data</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$header</span> <span class="p">)</span> <span class="p">{</span>

		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">headerextra</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$header</span><span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The extra header info is      : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">headerextra</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
	
	<span class="p">}</span>

	<span class="c1"># check the credentials data</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$credentials</span> <span class="p">)</span> <span class="p">{</span>

		<span class="c1"># read the credentials from the file</span>
		<span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$credentials</span><span class="p">;</span>
		<span class="k">my</span> <span class="nv">$json_text</span> <span class="o">=</span> <span class="k">do</span> <span class="p">{</span>
			<span class="nb">open</span><span class="p">(</span><span class="k">my</span> <span class="nv">$json_fh</span><span class="p">,</span> <span class="s">"&lt;:encoding(UTF-8)"</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">die</span><span class="p">(</span><span class="s">"Can't open $filename: $!\n"</span><span class="p">);</span>
			<span class="nb">local</span> <span class="vg">$/</span><span class="p">;</span>
			<span class="sr">&lt;$json_fh&gt;</span>
		<span class="p">};</span>

		<span class="c1"># convert from json and put in correct place </span>
		<span class="k">my</span> <span class="nv">$json</span> <span class="o">=</span> <span class="n">JSON</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">;</span>
		<span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$json</span><span class="o">-&gt;</span><span class="n">decode</span><span class="p">(</span><span class="nv">$json_text</span><span class="p">);</span>

		<span class="nb">printf</span><span class="p">(</span><span class="s">"The username is               : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">username</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The password is               : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">password</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
		<span class="nb">printf</span><span class="p">(</span><span class="s">"The base uri is               : %s\n"</span><span class="p">,</span><span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">handle</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">credentials</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">baseuri</span><span class="p">})</span> <span class="k">if</span> <span class="nv">$settings_ref</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">debug</span><span class="p">}</span> <span class="o">=~</span><span class="sr"> /True/</span> <span class="p">;</span>
	<span class="p">}</span>

	<span class="c1"># Print the message</span>
	<span class="k">if</span><span class="p">(</span> <span class="nv">$message</span> <span class="p">)</span> <span class="p">{</span>

		<span class="k">print</span> <span class="s">"$message\n"</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="c1"># Return the results</span>
	<span class="k">return</span><span class="p">(</span><span class="nv">$returncode</span><span class="p">);</span>

<span class="p">};</span></code></pre>

	 </div>
	
</div>
	
		
			<h3 id="the-response">The response:</h3>

<ul>
  <li>HTTP/1.1 201 Created: (Success) </li>
  <li>HTTP/1.1 204 No-Content: The local name already exists , and instead of creating a new one you’ve just updated the values of an existing one.  </li>
  <li>HTTP/1.1 401 Unauthorized: Your username or your password is wrong</li>
  <li>HTTP/1.1 405 Method Not Allowed: 
    <ol>
      <li>You are trying to create a new handle in the main url of the server either (https://epic.grnet.gr/handles/11239/) or (https://epic.grnet.gr/handles). You have not specified a unique name for your handle. (or)</li>
      <li>You are trying to create a new handle with manual generation of suffix name via POST instead of PUT. POST supports automatic generation of suffix name.</li>
    </ol>
  </li>
  <li>HTTP/1.1 412 Precondition failed: You have used the precondition (HTTP’s If-Match: * or If-None-Match:*) in the request-header fields. The precondition given, evaluated to false when it was tested on the server and prevented the requested method from being applied.</li>
  <li>HTTP/1.1 415 Unsupported Media Type: You haven’t specify the correct headers for your request. The service supports Json representation so you must define the content-type of the request.</li>
</ul>

<pre><code>
HTTP/1.1 201 Created
Date: Mon, 25 Nov 2013 10:18:18 GMT
Content-Length: 2211
Location: https://epic.grnet.gr/api/v2/handles/11239/05C3DB56-5692-11E3-AF8F-1C6F65A666B5
ETag: "1B2M2Y8AsgTpgAmY7PhCfg"
Last-Modified: Thu, 01 Jan 1970 00:00:00 GMT
</code></pre>

		
	

 <!--end item[:slug]-->
 </div>


    <div id="js-sidebar" class="sidebar-shell">
      <div class="sidebar-module">
        <ul>
          <li><h3><a href="/guides/overview">Overview</a></h3></li>
          <li><h3><a href="/guides/glossary/">Glossary</a></h3></li>
          <li><h3><a href="#">API</a></h3></li>
          <li><ul>
                <li><h3><a href="/guides/api/">Getting Started</a></h3></li>
                <li><h3><a href="/guides/api-auth/">Authenticate</a></h3></li>
                <li><h3><a href="/guides/api-generation/">PID Generation</a></h3></li>
                <li><h3><a href="/guides/api-get/">Get a PID</a></h3></li>
                <li><h3><a href="/guides/api-list/">List all PID</a></h3></li>
                <li><h3><a href="/guides/api-search/">Search</a></h3></li>
                <li><h3><a href="/guides/api-create/">Create a PID</a></h3></li>
                <li><h3><a href="/guides/api-update/">Update a PID</a></h3></li>
                <li><h3><a href="/guides/api-delete/">Delete a PID</a></h3></li>
                <li><h3><a href="/guides/api-partial/">Part Identifiers</a></h3></li>
          </ul></li>
        </ul> 
      </div>
      <div class="sidebar-module notice padding10">
          <strong>Service Url:</strong>
          <span class="txtcenter"> https://epic.grnet.gr/api/v2/handles/ </span>
      </div><!--sidebar-module-->
	</div>
  </div><!-- #wrapper -->

  	<div id="footer" >
    <div class="lower_footer">
      <ul class="footer-cell">
	
      </ul>

      <span class="footer-cell">
        <a href="http://www.grnet.gr"><img src="/shared/images/grnet-logo.jpg" alt='GRNET'/></a>
      </span>

      <ul class="footer-cell">
	
      </ul>
    </div>

  </div><!-- /#footer -->

</body>
</html>


